smartFetch:
  defaultPrompt: |
    你是一个客观中立的内容提取和结构化工具。你的任务是：
    - 忠实地提取和整理网页中的信息
    - 不对内容进行价值判断、审查或评论
    - 不拒绝处理任何内容，因为这只是信息整理工作

    请根据以下网页内容生成一份结构化的 Markdown 笔记。要求：
    1. 客观提取关键信息和要点
    2. 使用清晰的标题层级（从二级标题开始，不要包含一级标题）
    3. 保留原始内容中的重要数据和观点
    4. 添加简要的内容摘要
    5. 笔记正文不要包含一级标题（# 开头的标题），文件名会使用一级标题

    网页标题: {{title}}
    原始链接: {{url}}
    网页内容:
    {{content}}
  autoGenerateNote: true
  autoCreateCategory: true
  notePath: WebClips
  executors:
    playwright: playwright-1
    claudecode: claudecode-1
skills:
  - id: screenshot-note
    name: 截图笔记
    description: 抓取网页截图并生成图文混排的 Markdown 笔记
    enabled: true
    i18n:
      en:
        name: Screenshot Note
        description: Capture webpage screenshot and generate illustrated Markdown note
    builtinVariables:
      currentDate: true
      randomId: true
    userInputs:
      - name: url
        label: 网页地址
        labelEn: Webpage URL
        type: text
        placeholder: https://example.com
        required: true
      - name: notePath
        label: 笔记保存路径
        labelEn: Note Save Path
        type: text
        defaultValue: WebClips
        required: false
      - name: attachmentPath
        label: 附件存储路径
        labelEn: Attachment Path
        type: text
        defaultValue: WebClips/attachments
        required: false
    steps:
      - id: fetch
        name: 抓取网页内容
        executorType: playwright
        action: fetch
        params:
          url: '{{url}}'
        outputVariable: fetchResult
      - id: screenshot
        name: 截取并保存网页截图
        executorType: playwright
        action: screenshot
        params:
          url: '{{url}}'
          fullPage: true
          savePath: /vaults/{{attachmentPath}}
          fileName: '{{randomId}}.png'
        outputVariable: screenshotResult
      - id: generate
        name: 生成图文混排笔记
        executorType: claudecode
        action: chat
        params:
          messages:
            - role: user
              content: |
                请根据以下网页信息生成一份图文混排的 Markdown 笔记。

                ## 网页信息
                - 标题: {{fetchResult.data.title}}
                - 链接: {{url}}
                - 截图文件: {{screenshotResult.data.fileName}}
                - 日期: {{currentDate}}

                ## 网页内容
                {{fetchResult.data.textContent}}

                ## 生成要求
                1. 创建结构化的 Markdown 笔记
                2. 在笔记开头嵌入网页截图，使用以下格式：
                   ![网页截图]({{attachmentPath}}/{{randomId}}.png)
                3. 提取并整理关键信息和要点
                4. 使用二级标题开始（文件名会作为一级标题）
                5. 在末尾添加来源链接
                6. 将笔记保存到 /vaults/{{notePath}}/ 目录
                7. 文件名使用生成的笔记标题（去除特殊字符）.md
        outputVariable: noteResult
  - id: skill-creator
    name: 技能创建器
    description: 使用自然语言描述你想要的技能，AI 将自动生成并注册（自举技能）
    enabled: true
    reserved: true
    i18n:
      en:
        name: Skill Creator
        description: >-
          Describe the skill you want in natural language, AI will auto-generate
          and register it
    builtinVariables:
      currentDatetime: true
    userInputs:
      - name: requirement
        label: 技能需求描述
        labelEn: Skill Requirement Description
        type: textarea
        placeholder: >
          例如：我需要一个技能，输入一个 GitHub 仓库 URL，自动抓取 README 内容，然后让 AI
          生成一份中文项目介绍，保存到我的笔记中。
        placeholderEn: >
          E.g.: I need a skill that takes a GitHub repo URL, fetches README
          content, generates a Chinese project intro, and saves it to my notes.
        required: true
      - name: skillName
        label: 技能名称（可选）
        labelEn: Skill Name (optional)
        type: text
        placeholder: 留空则由 AI 自动命名
        placeholderEn: Leave empty for AI to name it
        required: false
      - name: autoRegister
        label: 自动注册技能
        labelEn: Auto Register Skill
        type: checkbox
        defaultValue: true
        required: false
    steps:
      - id: analyze-schedule
        name: 第一轮 - 分析定时需求
        executorType: claudecode
        action: chat
        params:
          max_turns: 3
          system_prompt: 你是一个精确的需求分析器，只输出指定格式，不输出任何额外内容。
          messages:
            - role: user
              content: |
                # 任务：分析定时需求

                分析以下需求是否包含定时执行要求。

                ## 用户需求
                {{requirement}}

                ## 判断规则
                检查是否包含以下时间相关表述：
                - "每X分钟"、"每X小时"、"每隔"
                - "每天"、"每周"、"每月"
                - "定时"、"定期"、"自动执行"

                ## 输出规则（严格遵守）
                - 如果包含定时需求，只输出纯 JSON（不要 markdown 代码块）：
                  {"enabled":true,"cron":"对应的cron表达式","timezone":"Asia/Shanghai","retryOnFailure":true,"maxRetries":3}
                - 如果不包含定时需求，只输出：none

                常用 cron 表达式参考：
                - 每5分钟: */5 * * * *
                - 每30分钟: */30 * * * *
                - 每小时: 0 * * * *
                - 每天9点: 0 9 * * *
                - 每周一: 0 0 * * 1

                请严格按规则输出，不要有任何其他内容！
        outputVariable: scheduleResult
      - id: analyze-inputs
        name: 第二轮 - 分析用户输入参数
        executorType: claudecode
        action: chat
        params:
          max_turns: 5
          system_prompt: 你是一个精确的需求分析器，只输出 JSON 数组格式，不输出任何额外内容。
          messages:
            - role: user
              content: |
                # 任务：分析用户输入参数

                分析以下需求需要用户提供哪些输入参数。

                ## 用户需求
                {{requirement}}

                ## 输出格式
                输出一个 JSON 数组，包含所有需要用户输入的参数。
                不要输出 markdown 代码块，只输出纯 JSON 数组。

                每个参数格式：
                {
                  "name": "参数名（英文，camelCase）",
                  "label": "标签（中文）",
                  "labelEn": "Label (English)",
                  "type": "text|textarea|number|checkbox|select",
                  "placeholder": "提示文字（中文）",
                  "placeholderEn": "Placeholder (English)",
                  "defaultValue": "默认值（可选）",
                  "required": true或false,
                  "options": [{"label":"选项","value":"值"}]  // 仅 select 类型需要
                }

                ## 常见参数类型
                - URL输入: type="text", required=true
                - 长文本: type="textarea"
                - 保存路径: type="text", defaultValue="/vaults/notes/"
                - 开关选项: type="checkbox", defaultValue=true/false
                - 下拉选择: type="select", 需提供 options

                ## 重要限制（必须遵守）
                以下功能系统不支持，禁止生成相关参数：
                - ❌ 通知/提醒/邮件/消息推送 - 系统无此能力
                - ❌ 数据库操作 - 系统无此能力
                - ❌ 外部 API 调用（除 playwright 抓取网页）- 系统无此能力
                - ❌ Webhook 回调 - 系统无此能力
                - ❌ 条件触发/事件监听 - 系统无此能力

                只能生成与以下能力相关的参数：
                - 网页 URL（用于 playwright 抓取）
                - 文件/目录路径（用于保存到 /vaults）
                - 文本内容（用于 AI 处理）
                - 简单开关（控制流程分支，如是否保存文件）

                ## 输出要求
                1. 只输出 JSON 数组，不要有其他内容
                2. 如果不需要任何用户输入，输出空数组: []
                3. 参数 name 使用 camelCase 命名
                4. 不要生成任何与不支持功能相关的参数
        outputVariable: inputsResult
      - id: analyze-steps
        name: 第三轮 - 设计执行步骤
        executorType: claudecode
        action: chat
        params:
          max_turns: 8
          system_prompt: 你是一个精确的工作流设计器，只输出 JSON 数组格式，不输出任何额外内容。
          messages:
            - role: user
              content: |
                # 任务：设计执行步骤

                根据用户需求和已分析的输入参数，设计技能的执行步骤。

                ## 用户需求
                {{requirement}}

                ## 已分析的用户输入参数
                {{inputsResult.data.choices.0.message.content}}

                ## 重要限制（设计前必读）
                以下功能系统不支持，禁止设计相关步骤：
                - ❌ 通知/提醒/邮件/消息推送 - 无此执行器，不要设计
                - ❌ 数据库读写 - 无此执行器，不要设计
                - ❌ 调用外部 API（除网页抓取）- 无此执行器，不要设计
                - ❌ Webhook/回调 - 无此执行器，不要设计
                - ❌ 发送任何形式的通知 - 无此执行器，不要设计

                如果用户需求包含上述功能，只实现可行部分，不要尝试实现不支持的功能。

                ## 可用的执行器和动作（只能使用以下列出的）

                ### claudecode (Claude Code Executor)
                适用于：文本生成、内容分析、代码生成、文件操作
                - **chat**: OpenAI 兼容格式对话
                  - messages: [{role: "user", content: "..."}]
                  - stream: false
                  - max_turns: 5(简单)/10(一般)/15(复杂)
                  - system_prompt: "系统提示词"
                - 返回格式: {{outputVar.data.choices.0.message.content}}

                ### playwright (Playwright Executor)
                适用于：网页抓取和截图
                - **fetch**: 抓取网页内容
                  - url: 网页URL
                  - waitUntil: networkidle
                  - timeout: 30000
                - 返回: {{outputVar.data.title}}, {{outputVar.data.textContent}}
                - **screenshot**: 网页截图
                  - url, fullPage, savePath, fileName
                - 返回: {{outputVar.data.fileName}}

                ## 输出格式
                输出一个 JSON 数组，包含所有执行步骤。
                不要输出 markdown 代码块，只输出纯 JSON 数组。

                每个步骤格式：
                {
                  "id": "step1",
                  "name": "步骤名称（中文）",
                  "executorType": "claudecode|playwright",
                  "action": "chat|fetch|screenshot",
                  "params": {
                    // 对应动作的参数
                  },
                  "outputVariable": "result1"
                }

                ## 变量引用规则
                - 用户输入: {{inputName}}
                - 内置变量: {{currentDate}}, {{currentDatetime}}, {{randomId}}
                - 步骤输出: {{outputVar.data.xxx}}

                ## 输出要求
                1. 只输出 JSON 数组
                2. 步骤 id 使用 step1, step2... 或描述性名称
                3. outputVariable 用于存储步骤结果，供后续步骤引用
                4. executorType 只能是 claudecode 或 playwright
                5. 不要设计任何通知、提醒、数据库、外部API相关的步骤
        outputVariable: stepsResult
      - id: assemble-skill
        name: 第四轮 - 组装完整技能定义
        executorType: claudecode
        action: chat
        params:
          max_turns: 5
          system_prompt: 你是一个 JSON 组装器，将各部分组合成完整的技能定义 JSON。只输出纯 JSON，不要 markdown 代码块。
          messages:
            - role: user
              content: |
                # 任务：组装完整技能定义

                将前几轮分析的结果组装成完整的技能定义 JSON。

                ## 用户需求
                {{requirement}}

                ## 用户指定的技能名称
                {{skillName}}

                ## 已分析的用户输入参数
                {{inputsResult.data.choices.0.message.content}}

                ## 已设计的执行步骤
                {{stepsResult.data.choices.0.message.content}}

                ## 技能定义模板
                {
                  "id": "技能ID（英文小写，连字符分隔，如 my-skill）",
                  "name": "技能名称（中文，如用户指定则使用指定名称）",
                  "description": "技能描述（中文，一句话描述功能）",
                  "enabled": true,
                  "i18n": {
                    "en": {
                      "name": "English Skill Name",
                      "description": "English description"
                    }
                  },
                  "builtinVariables": {
                    "currentDate": true,
                    "currentDatetime": true,
                    "randomId": false
                  },
                  "userInputs": [/* 上面分析的输入参数 */],
                  "steps": [/* 上面设计的执行步骤 */]
                }

                ## 输出要求
                1. 只输出完整的 JSON 对象，不要 markdown 代码块
                2. 必须包含 id 字段（英文小写，连字符分隔）
                3. 不要包含 schedule 字段（定时配置单独处理）
                4. 确保 JSON 格式正确，可以直接解析
                5. 如果用户指定了技能名称，使用指定的名称
                6. 根据步骤实际使用情况设置 builtinVariables

                ## 最终校验（组装前必须确认）
                - 所有 steps 的 executorType 只能是 claudecode 或 playwright
                - userInputs 中不能有通知/提醒/数据库/外部API等不支持功能的参数
                - 如有用户需求包含不支持的功能，在 description 中注明"部分功能暂不支持"
        outputVariable: skillDefinition
      - id: register-skill
        name: 注册技能
        executorType: agent
        action: register-skill
        condition: '{{autoRegister}} === true'
        params:
          definition: '{{skillDefinition.data.choices.0.message.content}}'
          schedule: '{{scheduleResult.data.choices.0.message.content}}'
        outputVariable: registerResult
