services:
  # Agent Service - Executor Manager with WebUI
  agent-service:
    build: ./agent-service
    container_name: agent-service
    restart: unless-stopped
    ports:
      - "8000:8000"
    volumes:
      - ./vaults:/vaults
      - ./agent-service/config:/app/config
    environment:
      - AGENT_PORT=8000
    depends_on:
      - claude-executor
      - puppeteer-executor

  # Obsidian Desktop (可选，直接使用官方镜像)
  obsidian:
    image: linuxserver/obsidian:latest
    container_name: obsidian
    restart: unless-stopped
    shm_size: "1gb"
    ports:
      - "3000:3000"
    volumes:
      - ./config:/config
      - ./vaults:/vaults
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Shanghai

  # Claude Code CLI HTTP API
  claude-executor:
    build: ./claude-executor
    container_name: claude-executor
    restart: unless-stopped
    ports:
      - "3002:3002"
    volumes:
      - ./vaults:/vaults
    environment:
      - ANTHROPIC_BASE_URL=${ANTHROPIC_BASE_URL}
      - ANTHROPIC_AUTH_TOKEN=${ANTHROPIC_AUTH_TOKEN}
      - AGENT_PORT=3002
      - CLAUDE_DEFAULT_MODEL=${CLAUDE_DEFAULT_MODEL:-claude-sonnet-4-5-20250929}
      # - CLAUDE_MAX_TURNS=10
      # - CLAUDE_SYSTEM_PROMPT=You are a helpful assistant

  # Puppeteer Web Scraping API
  puppeteer-executor:
    build: ./puppeteer-executor
    container_name: puppeteer-executor
    restart: unless-stopped
    ports:
      - "3003:3003"
    volumes:
      - ./vaults:/vaults
    environment:
      - AGENT_PORT=3003
    cap_add:
      - SYS_ADMIN

  # Playwright Browser Server (ARM compatible)
  playwright-executor:
    image: jacoblincool/playwright:chromium-light-server
    container_name: playwright-executor
    restart: unless-stopped
    ports:
      - "53333:53333"
    environment:
      - BROWSER_PORT=53333
      - BROWSER_WS_ENDPOINT=/playwright
      - BROWSER_HOST=0.0.0.0
